USE [SIC]
GO

CREATE TABLE CONFIRMAFACIL (
  ID                INT NOT NULL IDENTITY PRIMARY KEY,
  EMBARCADOR        VARCHAR(14) NOT NULL,
  NUMERO            VARCHAR(20) NOT NULL,
  SERIE             VARCHAR(10),
  CHAVE             VARCHAR(44),
  DT_EMISSAO        DATETIME NOT NULL,
  DT_EMBARQUE       DATETIME,
  DT_CHEGADA        DATETIME,
  DT_ENTREGA        DATETIME,
  DT_PREVISAO       DATETIME,
  DT_PREV_ORIGINAL  DATETIME,
  DT_AGENDAMENTO    DATETIME,
  VALOR             NUMERIC,
  CTRC              VARCHAR(20) NOT NULL,
  CTRC_OLD          VARCHAR(20),
  DESTINATARIO      VARCHAR(14) NOT NULL,
  TRANSPORTADOR     VARCHAR(14) NOT NULL,
  FLAG_COMPROVANTE  INT NOT NULL DEFAULT 0,
  JSON_COMPROVANTE  NVARCHAR(MAX),
  DT_UPDATE         DATETIME DEFAULT CURRENT_TIMESTAMP,
  CdEmpresa         INT,
  NrSeqControle     BIGINT,
  FASE_ID           INT NOT NULL DEFAULT 0
);

CREATE INDEX IDX_CONFIRMAFACIL_CHAVE  ON CONFIRMAFACIL (CHAVE);
CREATE INDEX IDX_CONFIRMAFACIL_NF     ON CONFIRMAFACIL (EMBARCADOR,NUMERO,SERIE);
CREATE INDEX IDX_CONFIRMAFACIL_CTRC   ON CONFIRMAFACIL (CTRC);
CREATE INDEX IDX_CONFIRMAFACIL_SENIOR ON CONFIRMAFACIL (CdEmpresa,NrSeqControle);
    
    --// FASES:
    --// 1 - 000 - PROCESSO DE TRANSPORTE INICIADO
    --// 2 - 128 - EM PROCESSO DE TRANSFERENCIA ENTRE AS FILIAIS
    --// 3 - 098 - CHEGADA NA CIDADE OU FILIAL DE DESTINO (passou para manual)
    --// 4 - 110 - EM ROTA PARA ENTREGA
    --// 5 - 001 - ENTREGA REALIZADA NORMALMENTE
    --// 6 - 999 - COMPROVANTE DE ENTREGA

-- ALTER TABLE CONFIRMAFACIL ADD FLAG_COMPROVANTE INT NOT NULL DEFAULT 0;
-- ALTER TABLE CONFIRMAFACIL ALTER COLUMN CTRC_OLD  VARCHAR(20) NULL;

-- ALTER TABLE CONFIRMAFACIL ADD CTRC_OLD  VARCHAR(20) NULL;
-- ALTER TABLE CONFIRMAFACIL ADD DT_AGENDAMENTO  DATETIME NULL; -- 02/09/2021 10:01

-- ALTER TABLE CONFIRMAFACIL ADD JSON_COMPROVANTE NVARCHAR(MAX); 06/09/2021