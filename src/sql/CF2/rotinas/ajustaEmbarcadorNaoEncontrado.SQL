BEGIN TRY
    BEGIN TRANSACTION

    UPDATE CONFIRMAFACIL 
    SET EMBARCADOR = DESTINATARIO
    WHERE ID in (select CONFIRMAFACIL_ID from CONFIRMAFACILOCORRENCIA where RESPOSTA_MSG = 'Embarcador não encontrado.')
    ;

    UPDATE CONFIRMAFACILOCORRENCIA 
    SET FLAG_SEND = 0
    WHERE RESPOSTA_MSG = 'Embarcador não encontrado.'
    ;

    COMMIT TRANSACTION

END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
        ROLLBACK TRANSACTION

    DECLARE @ErrorMessage NVARCHAR(4000) = ERROR_MESSAGE()
    DECLARE @ErrorSeverity INT = ERROR_SEVERITY()
    DECLARE @ErrorState INT = ERROR_STATE()

    RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);
END CATCH
;
