USE [SIC]
GO

CREATE TABLE LUPEON_OCORRENCIA (
  ID                  INT NOT NULL IDENTITY PRIMARY KEY,
  LUPEON_ID           INT NOT NULL,
  OCORRENCIA_ID       INT NOT NULL,
  OCORRENCIA_NOME     VARCHAR(60),
  OCORRENCIA_DATA     DATETIME NOT NULL,
  OCORRENCIA_OBS      VARCHAR(2000),
  RECEBEDOR_DOC       VARCHAR(40),
  RECEBEDOR_NOME      VARCHAR(60),
  DT_CREATE           DATETIME DEFAULT CURRENT_TIMESTAMP,
  DT_SEND             DATETIME,
  RESPOSTA_MSG        VARCHAR(2000),
  RESPOSTA_STATUS     INT,
  RESPOSTA_PROTOCOLO  VARCHAR(60),
  CdEmpresa           INT,
  NrSeqControle       BIGINT,
  CdSequencia         INT,
  FLAG_SEND           INT NOT NULL DEFAULT 0,
  VER_ID              INT NOT NULL DEFAULT 1
);

CREATE INDEX IDX_LUPEON_OCORRENCIA_ID         ON LUPEON_OCORRENCIA (LUPEON_ID);
CREATE INDEX IDX_LUPEON_OCORRENCIA_SEND       ON LUPEON_OCORRENCIA (FLAG_SEND,DT_CREATE);
CREATE INDEX IDX_LUPEON_OCORRENCIA_SENIOR     ON LUPEON_OCORRENCIA (CdEmpresa,NrSeqControle,CdSequencia);

ALTER TABLE LUPEON_OCORRENCIA ADD CONSTRAINT FK_LUPEON_OCORRENCIA_ID 
FOREIGN KEY (LUPEON_ID) REFERENCES LUPEON_NFE(ID);

ALTER TABLE SIC..LUPEON_OCORRENCIA   
ADD CONSTRAINT LU_OCORRENCIA_UNQ UNIQUE (LUPEON_ID, OCORRENCIA_ID, CdEmpresa, NrSeqControle, CdSequencia, VER_ID );   
