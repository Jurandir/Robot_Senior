USE [SIC]
GO

CREATE TABLE ITRACK_OCORRENCIA (
  ID                  INT NOT NULL IDENTITY PRIMARY KEY,
  ITRACK_DANFE_ID     INT NOT NULL,
  OCORRENCIA_ID       INT NOT NULL,
  OCORRENCIA_NOME     VARCHAR(60),
  OCORRENCIA_DATA     DATETIME NOT NULL,
  OCORRENCIA_OBS      VARCHAR(2000),
  RECEBEDOR_DOC       VARCHAR(40),
  RECEBEDOR_NOME      VARCHAR(60),
  DT_CREATE           DATETIME DEFAULT CURRENT_TIMESTAMP,
  DT_SEND             DATETIME,
  RESPOSTA_MSG        VARCHAR(2000),
  RESPOSTA_STATUS     INT,
  RESPOSTA_PROTOCOLO  VARCHAR(60),
  CdEmpresa           INT,
  NrSeqControle       BIGINT,
  CdSequencia         INT,
  FLAG_SEND           INT NOT NULL DEFAULT 0
);

CREATE INDEX IDX_ITRACK_OCORRENCIA_ID         ON ITRACK_OCORRENCIA (ITRACK_DANFE_ID);
CREATE INDEX IDX_ITRACK_OCORRENCIA_SEND       ON ITRACK_OCORRENCIA (FLAG_SEND,DT_CREATE);
CREATE INDEX IDX_ITRACK_OCORRENCIA_SENIOR     ON ITRACK_OCORRENCIA (CdEmpresa,NrSeqControle,CdSequencia);

ALTER TABLE ITRACK_OCORRENCIA ADD CONSTRAINT FK_ITRACK_OCORRENCIA_DANFE_ID 
FOREIGN KEY (ITRACK_DANFE_ID) REFERENCES ITRACK_DANFE(ID);
