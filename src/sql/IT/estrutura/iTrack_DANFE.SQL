USE [SIC]
GO

CREATE TABLE ITRACK_DANFE (
  ID                INT NOT NULL IDENTITY PRIMARY KEY,
  IDCARGA           INT DEFAULT 0,    -- ID DA CARGA NO SISTEMA ITRACK
  EMBARCADOR        VARCHAR(14) NOT NULL,
  NUMERO            VARCHAR(20) NOT NULL,
  SERIE             VARCHAR(10),
  CHAVE             VARCHAR(44),
  DT_EMISSAO        DATETIME NOT NULL,
  DT_EMBARQUE       DATETIME,
  DT_CHEGADA        DATETIME,
  DT_ENTREGA        DATETIME,
  DT_PREVISAO       DATETIME,
  DT_PREV_ORIGINAL  DATETIME,
  DT_AGENDAMENTO    DATETIME,
  VALOR             NUMERIC,
  CTRC              VARCHAR(20) NOT NULL,
  CTRC_OLD          VARCHAR(20),
  DESTINATARIO      VARCHAR(14) NOT NULL,
  TRANSPORTADOR     VARCHAR(14) NOT NULL,
  FLAG_COMPROVANTE  INT NOT NULL DEFAULT 0,
  JSON_COMPROVANTE  NVARCHAR(MAX),
  DT_ENVIO          DATETIME,      -- DATA DO ENVIO DO COMPROVANTE
  DT_VALIDACAO      DATETIME,      -- DATA DE VALIDAÇÃO DA CARGA / RECEBIMENTO DO IDPKCARGA
  DT_UPDATE         DATETIME DEFAULT CURRENT_TIMESTAMP,
  CdEmpresa         INT,
  NrSeqControle     BIGINT,
  FASE_ID           INT NOT NULL DEFAULT 0,
  VER_ID            INT NOT NULL DEFAULT 1,
  BASE_CNPJ         VARCHAR(14)
);

CREATE INDEX IDX_ITRACK_DANFE_CHAVE   ON ITRACK_DANFE (CHAVE);
CREATE INDEX IDX_ITRACK_DANFE_NF      ON ITRACK_DANFE (EMBARCADOR,NUMERO,SERIE);
CREATE INDEX IDX_ITRACK_DANFE_CTRC    ON ITRACK_DANFE (CTRC);
CREATE INDEX IDX_ITRACK_DANFE_SENIOR  ON ITRACK_DANFE (CdEmpresa,NrSeqControle);
CREATE INDEX IDX_ITRACK_DANFE_IDCARGA ON ITRACK_DANFE (IDCARGA);

-- ALTER TABLE ITRACK_DANFE ADD VER_ID INT NOT NULL DEFAULT 1 ; 07/02/2022
-- ALTER TABLE ITRACK_DANFE ADD BASE_CNPJ  VARCHAR(14) NULL; 07/02/2022
